---
page_title: Plugin Development - Terraform Plugin Protocol
description: >-
  Learn how Terraform communicates with plugins.
---

# Terraform Plugin Protocol

The Terraform Plugin Protocol is a versioned interface between Terraform CLI and Terraform Plugins.

During [discovery](/plugin/how-terraform-works#discovery), the Terraform Registry uses the protocol version as additional compatibility metadata when deciding which plugin versions Terraform CLI can select. You can configure this metadata in the [Terraform Registry manifest file](/registry/providers/publishing#terraform-registry-manifest-file) when you create a plugin release.

Major versions of the protocol delineate Terraform CLI and Terraform Plugin compatibility. Minor versions of the protocol are additive. The protocol is implemented in [Protocol Buffers](https://developers.google.com/protocol-buffers) and [gRPC](https://grpc.io/), with the canonical source for protocol definitions located in the [Terraform CLI repository](https://github.com/hashicorp/terraform/tree/main/docs/plugin-protocol).

## Protocol Version 6

Protocol version 6 is compatible with Terraform CLI version 1.0 and later. Protocol version 6 includes all version 5 functionality for providers, plus:

* **Nested Attributes**: Define `SchemaAttribute` with the `NestedType` field.
  * Enable practitioners to use easier [argument syntax](/language/syntax/configuration#arguments) instead of [block syntax](/language/syntax/configuration#blocks).
  * Configure value sensitivity on individual nested attributes, rather than an entire read-only (`Computed` only) attribute.

Implementations include:

* [terraform-plugin-framework](/plugin/framework): A higher-level SDK that makes Terraform provider development easier by abstracting implementation details.
* [terraform-plugin-go tf6server](https://pkg.go.dev/github.com/hashicorp/terraform-plugin-go/tfprotov6/tf6server): A lower-level SDK to develop Terraform providers for more advanced use cases.
* [tf5to6server](/plugin/mux/translating-protocol-version-5-to-6): A package to translate protocol version 5 providers into protocol version 6.
* [tf6muxserver](/plugin/mux/combining-protocol-version-6-providers): A package to combine multiple protocol version 6 providers.

## Protocol Version 5

Protocol version 5 is compatible with Terraform CLI version 0.12 and later.

Implementations include:

* [terraform-plugin-framework](/plugin/framework): A higher-level SDK that makes Terraform provider development easier by abstracting implementation details.
* [terraform-plugin-sdk/v2](/plugin/sdkv2): A higher-level SDK that makes Terraform provider development easier by abstracting implementation details.
* [terraform-plugin-go tf5server](https://pkg.go.dev/github.com/hashicorp/terraform-plugin-go/tfprotov5/tf5server): A lower-level SDK to develop Terraform providers for more advanced use cases.
* [tf6to5server](/plugin/mux/translating-protocol-version-6-to-5): A package to translate protocol version 6 providers into protocol version 5.
* [tf5muxserver](/plugin/mux/combining-protocol-version-5-providers): A package to combine multiple protocol version 5 providers.

## Protocol RPCs

The Terraform plugin protocol specifies the following RPCs:

| Protocol Version 5           | Protocol Version 6           |
|------------------------------|------------------------------|
| `GetSchema`                  | `GetProviderSchema`          |
| `PrepareProviderConfig`      | `ValidateProviderConfig`     |
| `ValidateResourceTypeConfig` | `ValidateResourceConfig`     |
| `ValidateDataSourceConfig`   | `ValidateDataResourceConfig` |
| `UpgradeResourceState`       | `UpgradeResourceState`       |
| `Configure`                  | `ConfigureProvider`          |
| `ReadResource`               | `ReadResource`               |
| `ReadDataSource`             | `ReadDataSource`             |
| `PlanResourceChange`         | `PlanResourceChange`         |
| `ApplyResourceChange`        | `ApplyResourceChange`        |
| `ImportResourceState`        | `ImportResourceState`        |

![diagram: Terraform Plugin Protocol 6 RPCs](/img/docs/terraform-plugin-protocol-6-rpcs-all.png)

## RPCs and Terraform commands

The following illustrate the RPCs that are sent during execution of the specified Terraform commands.

The RPCs issued are for a provider that is using version 6 of the Terraform plugin protocol when the Terraform configuration contains configuration for the provider, a resource and a data source.

### _terraform validate_

Executing _terraform validate_ results in the following unique RPCs:

![diagram: Terraform Plugin Protocol 6 Validate RPCs](/img/docs/terraform-plugin-protocol-6-rpcs-validate.png)

The actual sequence of RPCs is as follows:

- [GetProviderSchema](#getproviderschema-rpc)
- [GetProviderSchema](#getproviderschema-rpc)
- [ValidateProviderConfig](#validateconfig-rpcs)
- [ValidateResourceConfig](#validateconfig-rpcs)
- [ValidateDataResourceConfig](#validateconfig-rpcs)

The correlation between the RPCs and the Terraform plugin framework methods is as follows:

| Protocol RPCs                                                                     | Framework Functionality                                                                                                                                            |
|-----------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `GetProviderSchema`                                                               | `provider.Provider`, `resource.Resource`, and `datasource.DataSource` interface `Schema` method                                                                    |
| `ValidateProviderConfig` / `ValidateResourceConfig` /`ValidateDataResourceConfig` | `provider.Provider`, `resource.Resource`, and `datasource.DataSource` interface `Schema` method validators, `ConfigValidators` method, and `ValidateConfig` method |

### _terraform plan_

Executing _terraform plan_ results in the following unique RPCs:

![diagram: Terraform Plugin Protocol 6 Plan RPCs](/img/docs/terraform-plugin-protocol-6-rpcs-plan.png)

The actual sequence of RPCs is as follows:

- [GetProviderSchema](#getproviderschema-rpc)
- [GetProviderSchema](#getproviderschema-rpc)
- [ValidateProviderConfig](#validateconfig-rpcs)
- [ValidateResourceConfig](#validateconfig-rpcs)
- [ValidateDataResourceConfig](#validateconfig-rpcs)
- [GetProviderSchema](#getproviderschema-rpc)
- [ValidateProviderConfig](#validateconfig-rpcs)
- [ConfigureProvider](#configureprovider-rpc)
- [ValidateResourceConfig](#validateconfig-rpcs)
- [ValidateDataResourceConfig](#validateconfig-rpcs)
- [ReadDataSource](#read-rpcs)
- [PlanResourceChange](#planresourcechange-rpc)

The correlation between the RPCs and the Terraform plugin framework methods is as follows:

| Protocol RPCs                                                                     | Framework Functionality                                                                                                                                            |
|-----------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `GetProviderSchema`                                                               | `provider.Provider`, `resource.Resource`, and `datasource.DataSource` interface `Schema` method                                                                    |
| `ValidateProviderConfig` / `ValidateResourceConfig` /`ValidateDataResourceConfig` | `provider.Provider`, `resource.Resource`, and `datasource.DataSource` interface `Schema` method validators, `ConfigValidators` method, and `ValidateConfig` method |
| `ConfigureProvider`                                                               | `provider.Provider` interface `Configure` method                                                                                                                   |
| `ReadResource` / `ReadDataSource`                                                 | `resource.Resource` and `datasource.DataSource` interface `Read` method                                                                                            |
| `PlanResourceChange`                                                              | `resource.Resource` interface `Schema` method plan modifiers and `ModifyPlan` method                                                                               |

### _terraform apply_

Executing _terraform apply_ (with default -refresh=true and -auto-approve) results in the following unique RPCs:

![diagram: Terraform Plugin Protocol 6 Plan RPCs](/img/docs/terraform-plugin-protocol-6-rpcs-apply.png)

The actual sequence of RPCs is as follows:

- [GetProviderSchema](#getproviderschema-rpc)
- [GetProviderSchema](#getproviderschema-rpc)
- [ValidateProviderConfig](#validateconfig-rpcs)
- [ValidateResourceConfig](#validateconfig-rpcs)
- [ValidateDataResourceConfig](#validateconfig-rpcs)
- [GetProviderSchema](#getproviderschema-rpc)
- [ValidateProviderConfig](#validateconfig-rpcs)
- [ConfigureProvider](#configureprovider-rpc)
- UpgradeResourceState
  - only called if resource already exists in state
- [ValidateResourceConfig](#validateconfig-rpcs)
- [ValidateDataResourceConfig](#validateconfig-rpcs)
- [ReadResource](#read-rpcs)
  - only called if resource already exists in state)
- [ReadDataSource](#read-rpcs)
- [PlanResourceChange](#planresourcechange-rpc)
  - if _-auto-approve_ is not used this is the point at which Terraform prompts the practitioner to confirm the proposed changes
- [GetProviderSchema](#getproviderschema-rpc)
- [ValidateProviderConfig](#validateconfig-rpcs)
- [ConfigureProvider](#configureprovider-rpc)
- UpgradeResourceState
  - only called if resource already exists in state
- [ValidateResourceConfig](#validateconfig-rpcs)
- [PlanResourceChange](#planresourcechange-rpc)
- [ApplyResourceChange](#applyresourcechange-rpc)

The correlation between the RPCs and the Terraform plugin framework methods is as follows:

| Protocol RPCs                                                                     | Framework Functionality                                                                                                                                            |
|-----------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `GetProviderSchema`                                                               | `provider.Provider`, `resource.Resource`, and `datasource.DataSource` interface `Schema` method                                                                    |
| `ValidateProviderConfig` / `ValidateResourceConfig` /`ValidateDataResourceConfig` | `provider.Provider`, `resource.Resource`, and `datasource.DataSource` interface `Schema` method validators, `ConfigValidators` method, and `ValidateConfig` method |
| `ConfigureProvider`                                                               | `provider.Provider` interface `Configure` method                                                                                                                   |
| `ReadResource` / `ReadDataSource`                                                 | `resource.Resource` and `datasource.DataSource` interface `Read` method                                                                                            |
| `PlanResourceChange`                                                              | `resource.Resource` interface `Schema` method plan modifiers and `ModifyPlan` method                                                                               |
| `ApplyResourceChange`                                                             | `resource.Resource` interface `Create`, `Update`, or `Delete` method                                                                                               |

## RPCs and Terraform plugin framework

The RPCs sent by Terraform core when Terraform commands are executed result in the subsequent execution of methods defined within Terraform plugin providers.

The RPCs listed are for a provider that is using version 6 of the Terraform plugin protocol. The equivalent RPCs for a provider that is using version 5 of the protocol are listed in [Protocol RPCs](#protocol-rpcs). The same provider functions and methods are called irrespective of the protocol version that is being used.

## GetProviderSchema RPC

When _terraform validate | plan | apply_ are executed Terraform core issues the `GetProviderSchema` RPC.

The RPC flows through the Terraform plugin framework and ultimately calls the `Schema` function on the provider and each of the resources and data sources that the provider defines.

![diagram: GetProviderSchema RPC](/img/docs/terraform-plugin-protocol-6-get-provider-schema.png)

## ValidateConfig RPCs

When _terraform validate | plan | apply_ are executed if the Terraform configuration contains configuration for the provider then Terraform core issues the `ValidateProviderConfig` RPC. Additionally, the `ValidateResourceConfig` and `ValidateDataResourceConfig` RPCs are issued for each of the resources and data sources that appear in the Terraform configuration. There is a 1:1 match between the schema returned from the `GetProviderSchema` RPC and the `Validate<Provider|Resource|DataResource>Config` RPCs.

The `Validate<Provider|Resource|DataResource>Config` RPCs flow through the Terraform plugin framework and ultimately call the `Validate<Provider|Resource|DataSource>` function on each of the ConfigValidators, the `ValidateConfig` function on the provider, resource or data source, and each of the `Validate<type>` functions defined on each of the attributes and blocks defined within the provider, resource or data source schema.

The `ValidateResourceConfig` and `ValidateDataResourceConfig` RPCs additionally call `resource.Configure` and `datasource.Configure`, respectively.

![diagram: ValidateProvider|Resource|DataSourceConfig RPCs](/img/docs/terraform-plugin-protocol-6-validate-provider-resource-datasource-config.png)

## ConfigureProvider RPC

When _terraform plan | apply_ are executed Terraform core issues the `ConfigureProvider` RPC.

The RPC flows through the Terraform plugin framework and ultimately calls the `Configure` function on the provider.

![diagram: ConfigureProvider RPC](/img/docs/terraform-plugin-protocol-6-configure-provider.png)

## Read RPCs

When _terraform plan | apply_ are executed Terraform core issues the `ReadResource` and `ReadDataSource` RPCs. Note that the `ReadResource` RPC is only issued when a resource already exists in state.

The `ReadResource` and `ReadDataSource` RPCs flow through the Terraform plugin framework and ultimately call the `Read` function on the resource and data source, respectively.

![diagram: ReadResource|DataSource RPC](/img/docs/terraform-plugin-protocol-6-read-resource-datasource.png)

## PlanResourceChange RPC

When _terraform plan | apply_ are executed Terraform core issues the `PlanResourceChange` RPC. Note that the `PlanResourceChange` RPC is only issued when a resource exists in configuration and/or a resource already exists in state.

The `PlanResourceChange` RPC flows through the Terraform plugin framework and ultimately calls each of the `PlanModify<type>` functions on each of the attributes and blocks within the resource schema and `ModifyPlan` on the resource if the `resource.ResourceWithModifyPlan` interface has been implemented.

The `PlanResourceChange` RPC also calls `resource.Configure` if the `resource.ResourceWithConfigure` interface has been implemented.

![diagram: PlanResourceChange RPC](/img/docs/terraform-plugin-protocol-6-plan-resource-change.png)

## ApplyResourceChange RPC

When terraform apply is executed Terraform core issues the `ApplyResourceChange` RPC. Note that the `ApplyResourceChange` RPC is only issued when a resource exists in configuration and/or a resource already exists in state.

The `ApplyResourceChange` RPC flows through the Terraform plugin framework and ultimately calls either `resource.Create`, `resource.Update` or `resource.Delete` on the resource depending upon the contents of the state and the plan.

The `ApplyResourceChange` RPC also calls `resource.Configure` method if the `resource.ResourceWithConfigure` interface has been implemented.

![diagram: ApplyResourceChange RPC](/img/docs/terraform-plugin-protocol-6-apply-resource-change.png)

[0]: https://en.wikipedia.org/wiki/Static_build#Static_building

[1]: https://golang.org/
